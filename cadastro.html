<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro para Adoção</title>
    <link rel="stylesheet" href="style.css">
    <!-- Ícones para melhorar a usabilidade -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body id="pag-cadastro">

    <header class="cabecalho">
        <a href="inicio.html" class="link-logo">
            <img src="imagens/logo-extensa.png" alt="Logo ONG" class="logo-cabecalho" />
        </a>
        <nav class="nav-cabecalho">
            <a href="inicio.html">Início</a>
            <a href="Sobrenos.html">Sobre Nós</a>
            <a href="adote.html">Adote</a>
            <a href="nos-apoie.html">Nos Apoie</a>
            <a href="faleconosco.html">Fale Conosco</a>
        </nav>
    </header>

    <div class="main-cadastro-container">
        <div class="form-card">
            <div class="form-header">
                <h1><i class="fas fa-heart"></i> Formulário de Adoção</h1>
                <p>Ficamos felizes com seu interesse! Preencha os dados abaixo para conhecermos melhor você.</p>
            </div>

            <form id="form-adocao">
                
                <!-- Seção 1: Sobre o Animal -->
                <h3 class="section-title"><i class="fas fa-paw"></i> Qual animal você deseja adotar?</h3>
                <div class="form-group">
                    <label for="animal_desejado">Nome do Animal</label>
                    <input type="text" id="animal_desejado" name="animal_desejado" required readonly class="input-readonly">
                    <small class="form-text text-muted">Este campo é preenchido automaticamente ao clicar em "Adotar" na página anterior.</small>
                </div>

                <!-- Seção 2: Dados Pessoais -->
                <h3 class="section-title"><i class="fas fa-user"></i> Seus Dados</h3>
                
                <div class="form-group">
                    <label for="nome">Nome Completo</label>
                    <input type="text" id="nome" name="nome" placeholder="Digite seu nome completo" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="nascimento">Data de Nascimento</label>
                        <input type="date" id="nascimento" name="nascimento" required>
                    </div>
                    <div class="form-group">
                        <label for="instagram">Instagram</label>
                        <input type="text" id="instagram" name="instagram" placeholder="@seu.perfil" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="email">E-mail</label>
                        <input type="email" id="email" name="email" placeholder="seu@email.com" required>
                    </div>
                    <div class="form-group">
                        <label for="telefone">Telefone / WhatsApp</label>
                        <input type="tel" id="telefone" name="telefone" placeholder="(XX) 9XXXX-XXXX" required>
                    </div>
                </div>

                <!-- Seção 3: Endereço e Moradia -->
                <h3 class="section-title"><i class="fas fa-home"></i> Onde você mora?</h3>
                
                <div class="form-group">
                    <label for="endereco">Endereço Completo</label>
                    <input type="text" id="endereco" name="endereco" placeholder="Rua, Número, Bairro, Cidade" required>
                </div>

                <div class="form-group">
                    <label for="tipo_moradia">Tipo de Moradia</label>
                    <select id="tipo_moradia" name="tipo_moradia" required>
                        <option value="" disabled selected>Selecione...</option>
                        <option value="Casa">Casa</option>
                        <option value="Apartamento">Apartamento</option>
                        <option value="Sítio/Chácara">Sítio / Chácara</option>
                        <option value="Outro">Outro</option>
                    </select>
                </div>

                <!-- Seção 4: Perguntas Importantes -->
                <h3 class="section-title"><i class="fas fa-question-circle"></i> Perguntas Rápidas</h3>

                <div class="form-group">
                    <label for="motivo">Por que você deseja adotar?</label>
                    <textarea id="motivo" name="motivo" rows="3" maxlength="500" placeholder="Conte um pouco sobre sua motivação..." required></textarea>
                </div>

                <div class="form-group">
                    <label for="outros_animais">Possui outros animais? Se sim, quais?</label>
                    <textarea id="outros_animais" name="outros_animais" rows="2" placeholder="Ex: Tenho um gato de 3 anos castrado."></textarea>
                </div>

                <div class="form-group checkbox-group">
                    <label for="concorda_termos">
                        <input type="checkbox" id="concorda_termos_check" required onchange="atualizarSelect(this)">
                        Estou ciente da entrevista por videochamada e da taxa de contribuição de R$200,00 (caso aprovado).
                    </label>
                    <!-- Campo oculto para enviar valor 1 ou 0 para o banco -->
                    <select id="concorda_termos" name="concorda_termos" style="display:none;">
                        <option value="0">Não</option>
                        <option value="1">Sim</option>
                    </select>
                </div>

                <button type="submit" id="submit-button" class="btn-enviar">
                    <i class="fas fa-paper-plane"></i> Enviar Cadastro
                </button>
            </form>
        </div>
    </div>

    <footer class="rodape">
        <div class="sobre-rodape">
            <img src="imagens/logo-extensa.png" alt="logo extensa">
            <p>Somos uma ONG que resgata animais em situação de rua e maus tratos, cuidados e direcionamos para adoções responsáveis.</p>
        </div>
        <div class="contato-rodape">
            <a href="https://www.google.com/maps?q=Av.+Jos%C3%A9+Estima+Filho+-+Parque+Santa+Barbara,+S%C3%A3o+Paulo+-+SP,+Brasil"><img src="imagens/mapa.jpg" alt="mapa" class="mapa"></a>
            <p>Endereço: Av. José Estima Filho - Jardim Ângela</p>
        </div>
    </footer>

    <script>
        function atualizarSelect(checkbox) {
            const select = document.getElementById('concorda_termos');
            select.value = checkbox.checked ? "1" : "0";
        }

        function preencherAnimal() {
            const urlParams = new URLSearchParams(window.location.search);
            const nomeAnimal = urlParams.get('animal');

            if (nomeAnimal) {
                document.getElementById('animal_desejado').value = decodeURIComponent(nomeAnimal);
            } else {
                document.getElementById('animal_desejado').value = "Nenhum animal selecionado (Vá em 'Adote')";
            }
        }

        async function enviarFormulario(event) {
            event.preventDefault();
            const form = document.getElementById('form-adocao');
            const button = document.getElementById('submit-button');
            const formData = new FormData(form);

            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';

            try {
                const response = await fetch('api/cadastros/criar_cadastro.php', {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Erro na API: ${response.statusText}`);
                }

                const resultado = await response.json();

                if (resultado.success) {
                    alert('✅ Cadastro enviado com sucesso! Entraremos em contato pelo Instagram.');
                    form.reset();
                    window.location.href = 'inicio.html';
                } else {
                    alert('❌ Erro: ' + (resultado.error || 'Erro desconhecido.'));
                }

            } catch (error) {
                console.error('Erro:', error);
                alert('Ocorreu um erro de comunicação. Tente novamente.');
            } finally {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-paper-plane"></i> Enviar Cadastro';
            }
        }

        window.onload = preencherAnimal;
        document.getElementById('form-adocao').addEventListener('submit', enviarFormulario);
    </script>
</body>
</html>